# Java常用API與Lambda表達式 (Java 21)

## 27 API

### 27.1 Math

- Math是一個幫助我們進行數學計算的工具類別
- 私有化建構方法，所有方法都是靜態的

| 修飾符    | 方法名                   | 說明                                                     |
| --------- | ------------------------ | -------------------------------------------------------- |
| `int`     | `abs(int a)`             | 絕對值 (-2147483648沒有正數與之對應，所以abs結果產生bug) |
| `double`  | `ceil(double a)`         | 向上取整                                                 |
| `double`  | `floor(double a)`        | 向下取整                                                 |
| `int`     | `round(float a)`         | 四捨五入                                                 |
| `int`     | `max(int a,int b)`       | 取得兩個int中的最大值                                    |
| `double`  | `pow(double a,double b)` | 回傳a的b次方                                             |
| `double`  | `random()`               | 回傳值為double的隨機值，範圍[0.0,1.0)                    |

```java
public class MathDemo {
    public static void main(String[] args) {
        // 絕對值
        System.out.println(Math.abs(-5));     // 5
        System.out.println(Math.abs(3.14));   // 3.14
        
        // 向上取整
        System.out.println(Math.ceil(3.1));   // 4.0
        System.out.println(Math.ceil(3.9));   // 4.0
        
        // 向下取整
        System.out.println(Math.floor(3.1));  // 3.0
        System.out.println(Math.floor(3.9));  // 3.0
        
        // 四捨五入
        System.out.println(Math.round(3.4f)); // 3
        System.out.println(Math.round(3.6f)); // 4
        
        // 最大值與最小值
        System.out.println(Math.max(10, 20)); // 20
        System.out.println(Math.min(10, 20)); // 10
        
        // 次方
        System.out.println(Math.pow(2, 3));   // 8.0
        
        // 隨機數
        System.out.println(Math.random());    // 0.0 ~ 1.0之間的隨機數
        
        // 產生1-100之間的隨機整數
        int randomNum = (int)(Math.random() * 100) + 1;
        System.out.println(randomNum);
    }
}
```

### 27.2 System

- System類別包含一些實用的類別欄位和方法，它不能被實例化

| 修飾符        | 方法名                                                       | 說明                         |
| ------------- | ------------------------------------------------------------ | ---------------------------- |
| `static void` | `exit(int status)`                                           | 終止目前執行的Java虛擬機器   |
| `static long` | `currentTimeMillis()`                                        | 回傳目前系統的時間毫秒值形式 |
| `static void` | `arraycopy(Object src, int srcPos, Object dest, int destPos, int length)` | 陣列複製                     |

```java
public class SystemDemo {
    public static void main(String[] args) {
        // 取得目前時間的毫秒值
        long startTime = System.currentTimeMillis();
        System.out.println("開始時間: " + startTime);
        
        // 執行一些操作
        for (int i = 0; i < 1000000; i++) {
            // 模擬一些計算
        }
        
        long endTime = System.currentTimeMillis();
        System.out.println("結束時間: " + endTime);
        System.out.println("執行時間: " + (endTime - startTime) + "毫秒");
        
        // 陣列複製示範
        int[] src = {1, 2, 3, 4, 5};
        int[] dest = new int[5];
        System.arraycopy(src, 0, dest, 0, src.length);
        
        System.out.println("原始陣列: " + java.util.Arrays.toString(src));
        System.out.println("複製陣列: " + java.util.Arrays.toString(dest));
        
        // 結束程式
        // System.exit(0); // 0表示正常結束，非0表示異常結束
    }
}
```

### 27.3 Runtime

- Runtime類別封裝了執行時期的環境
- 每個Java應用程式都有一個Runtime類別的實例，使應用程式能夠與其執行的環境相連接
- 一般不能實例化，可以透過getRuntime()方法取得目前執行時期的實例

| 修飾符           | 方法名              | 說明                                |
| ---------------- | ------------------- | ----------------------------------- |
| `static Runtime` | `getRuntime()`      | 回傳與目前Java應用程式關聯的執行時期物件 |
| `void`           | `exit(int status)`  | 終止目前執行的虛擬機器              |
| `int`            | `availableProcessors()` | 回傳Java虛擬機器可用的處理器數量    |
| `long`           | `maxMemory()`       | 回傳Java虛擬機器試圖使用的最大記憶體量 |
| `long`           | `totalMemory()`     | 回傳Java虛擬機器的記憶體總量        |
| `long`           | `freeMemory()`      | 回傳Java虛擬機器的可用記憶體量      |
| `Process`        | `exec(String command)` | 在單獨的程序中執行指定的字串命令    |

```java
public class RuntimeDemo {
    public static void main(String[] args) {
        // 取得Runtime實例
        Runtime runtime = Runtime.getRuntime();
        
        // 取得可用處理器數量
        int processors = runtime.availableProcessors();
        System.out.println("可用處理器數量: " + processors);
        
        // 取得記憶體資訊
        long maxMemory = runtime.maxMemory();
        long totalMemory = runtime.totalMemory();
        long freeMemory = runtime.freeMemory();
        
        System.out.println("最大記憶體: " + maxMemory / 1024 / 1024 + "MB");
        System.out.println("總記憶體: " + totalMemory / 1024 / 1024 + "MB");
        System.out.println("可用記憶體: " + freeMemory / 1024 / 1024 + "MB");
        System.out.println("已使用記憶體: " + (totalMemory - freeMemory) / 1024 / 1024 + "MB");
        
        // 執行系統命令（需要異常處理）
        try {
            Process process = runtime.exec("notepad"); // Windows記事本
            System.out.println("已開啟記事本");
        } catch (Exception e) {
            System.out.println("無法執行命令: " + e.getMessage());
        }
    }
}
```

### 27.4 Object

- Object是Java的頂級父類別，所有類別都直接或間接的繼承於Object類別
- Object類別中的方法可以被所有子類別使用

| 修飾符            | 方法名           | 說明                                          |
| ----------------- | ---------------- | --------------------------------------------- |
| `String`          | `toString()`     | 回傳物件的字串表示形式                        |
| `boolean`         | `equals(Object obj)` | 比較物件是否相等                              |
| `protected Object` | `clone()`        | 建立並回傳此物件的副本                        |
| `int`             | `hashCode()`     | 回傳物件的雜湊碼值                            |
| `Class<?>`        | `getClass()`     | 回傳此物件的執行時期類別                      |

```java
public class ObjectDemo {
    public static void main(String[] args) {
        // 建立Person物件
        Person p1 = new Person("張三", 25);
        Person p2 = new Person("張三", 25);
        Person p3 = new Person("李四", 30);
        
        // toString()方法
        System.out.println(p1.toString()); // 姓名: 張三, 年齡: 25
        System.out.println(p1);            // 直接列印也會呼叫toString()
        
        // equals()方法
        System.out.println(p1.equals(p2)); // true (內容相同)
        System.out.println(p1.equals(p3)); // false (內容不同)
        
        // hashCode()方法
        System.out.println(p1.hashCode()); // 根據物件內容產生的雜湊碼
        System.out.println(p2.hashCode()); // 內容相同，雜湊碼也相同
        
        // getClass()方法
        System.out.println(p1.getClass().getSimpleName()); // Person
    }
}

class Person {
    private String name;
    private int age;
    
    public Person(String name, int age) {
        this.name = name;
        this.age = age;
    }
    
    // 重寫toString()方法
    @Override
    public String toString() {
        return "姓名: " + name + ", 年齡: " + age;
    }
    
    // 重寫equals()方法
    @Override
    public boolean equals(Object obj) {
        if (this == obj) return true;
        if (obj == null || getClass() != obj.getClass()) return false;
        
        Person person = (Person) obj;
        return age == person.age && 
               (name != null ? name.equals(person.name) : person.name == null);
    }
    
    // 重寫hashCode()方法
    @Override
    public int hashCode() {
        int result = name != null ? name.hashCode() : 0;
        result = 31 * result + age;
        return result;
    }
    
    // getter方法
    public String getName() { return name; }
    public int getAge() { return age; }
}
```

### 27.5 Arrays

- 操作陣列的工具類別

| 回傳型別  | 方法名                                                | 說明                     |
| --------- | ----------------------------------------------------- | ------------------------ |
| `String`  | `toString(陣列)`                                      | 把陣列拼接成一個字串     |
| `int`     | `binarySearch(陣列, 查找的元素)`                      | 二分搜尋法查找元素       |
| `int[]`   | `copyOf(原陣列, 新陣列長度)`                          | 複製陣列                 |
| `int[]`   | `copyOfRange(原陣列, 起始索引, 結束索引)`             | 複製陣列(指定範圍)       |
| `void`    | `fill(陣列, 元素)`                                    | 填充陣列                 |
| `void`    | `sort(陣列)`                                          | 按預設方式進行陣列排序   |
| `void`    | `sort(陣列, 排序規則)`                                | 按指定的規則排序         |

```java
import java.util.Arrays;
import java.util.Comparator;

public class ArraysDemo {
    public static void main(String[] args) {
        // 原始陣列
        int[] arr = {5, 2, 8, 1, 9, 3};
        System.out.println("原始陣列: " + Arrays.toString(arr));
        
        // 1. 陣列排序
        Arrays.sort(arr);
        System.out.println("排序後: " + Arrays.toString(arr)); // [1, 2, 3, 5, 8, 9]
        
        // 2. 二分搜尋 (陣列必須先排序)
        int index = Arrays.binarySearch(arr, 5);
        System.out.println("元素5的索引: " + index); // 3
        
        // 3. 陣列複製
        int[] copyArr = Arrays.copyOf(arr, 8); // 複製並擴充到8個元素
        System.out.println("複製陣列: " + Arrays.toString(copyArr)); // [1, 2, 3, 5, 8, 9, 0, 0]
        
        // 4. 範圍複製
        int[] rangeArr = Arrays.copyOfRange(arr, 2, 5); // 複製索引2-4的元素
        System.out.println("範圍複製: " + Arrays.toString(rangeArr)); // [3, 5, 8]
        
        // 5. 陣列填充
        int[] fillArr = new int[5];
        Arrays.fill(fillArr, 7);
        System.out.println("填充陣列: " + Arrays.toString(fillArr)); // [7, 7, 7, 7, 7]
        
        // 6. 字串陣列排序 - 按長度排序
        String[] strArr = {"apple", "banana", "kiwi", "grape", "orange"};
        Arrays.sort(strArr, (s1, s2) -> s1.length() - s2.length());
        System.out.println("按長度排序: " + Arrays.toString(strArr));
        
        // 7. 字串陣列排序 - 按字母順序倒序
        Arrays.sort(strArr, (s1, s2) -> s2.compareTo(s1));
        System.out.println("字母倒序: " + Arrays.toString(strArr));
    }
}
```

### 27.6 BigInteger

- 當整數超過long的範圍時使用
- 物件的值一旦建立，內部記錄就不能發生改變
- 只要進行計算都會產生一個新的BigInteger物件

**建構方法：**

| 方法名                            | 說明                                     |
| --------------------------------- | ---------------------------------------- |
| `BigInteger(String val)`          | 取得指定大整數                           |
| `BigInteger(String val, int radix)` | 取得指定進位制的大整數                   |
| `BigInteger valueOf(long val)`    | 靜態方法取得BigInteger的物件，內部有最佳化 |

**常用方法：**

| 方法名                                        | 說明                   |
| --------------------------------------------- | ---------------------- |
| `public BigInteger add(BigInteger val)`       | 加法                   |
| `public BigInteger subtract(BigInteger val)`  | 減法                   |
| `public BigInteger multiply(BigInteger val)`  | 乘法                   |
| `public BigInteger divide(BigInteger val)`    | 除法，取得商           |
| `public BigInteger[] divideAndRemainder(BigInteger val)` | 除法，取得商和餘數     |
| `public boolean equals(Object x)`             | 比較是否相同           |
| `public BigInteger pow(int exponent)`         | 次方                   |
| `public BigInteger max/min(BigInteger val)`   | 回傳較大值/較小值      |
| `public int intValue()`                       | 轉為int型別整數        |

```java
import java.math.BigInteger;

public class BigIntegerDemo {
    public static void main(String[] args) {
        // 建立BigInteger物件
        BigInteger num1 = new BigInteger("123456789012345678901234567890");
        BigInteger num2 = BigInteger.valueOf(999999999L);
        
        System.out.println("num1: " + num1);
        System.out.println("num2: " + num2);
        
        // 加法
        BigInteger sum = num1.add(num2);
        System.out.println("加法結果: " + sum);
        
        // 減法
        BigInteger diff = num1.subtract(num2);
        System.out.println("減法結果: " + diff);
        
        // 乘法
        BigInteger product = num2.multiply(BigInteger.valueOf(2));
        System.out.println("乘法結果: " + product);
        
        // 除法
        BigInteger quotient = num1.divide(BigInteger.valueOf(1000));
        System.out.println("除法結果: " + quotient);
        
        // 次方
        BigInteger power = BigInteger.valueOf(2).pow(10);
        System.out.println("2的10次方: " + power); // 1024
        
        // 比較
        BigInteger a = BigInteger.valueOf(100);
        BigInteger b = BigInteger.valueOf(200);
        System.out.println("a等於b: " + a.equals(b)); // false
        System.out.println("較大值: " + a.max(b));    // 200
        System.out.println("較小值: " + a.min(b));    // 100
    }
}
```

### 27.7 BigDecimal

- 解決小數運算精度失真的問題
- 用來表示較大的小數和進行精確的小數計算

**建構方法：**

| 方法名                               | 說明                    |
| ------------------------------------ | ----------------------- |
| `BigDecimal(String val)`             | 透過字串建立BigDecimal  |
| `static BigDecimal valueOf(double val)` | 透過靜態方法取得物件    |

**常用方法：**

| 方法名                                                | 說明         |
| ----------------------------------------------------- | ------------ |
| `public BigDecimal add(BigDecimal val)`               | 加法         |
| `public BigDecimal subtract(BigDecimal val)`          | 減法         |
| `public BigDecimal multiply(BigDecimal val)`          | 乘法         |
| `public BigDecimal divide(BigDecimal val)`            | 除法         |
| `public BigDecimal divide(BigDecimal val, int scale, RoundingMode mode)` | 除法(指定精度和捨入模式) |

```java
import java.math.BigDecimal;
import java.math.RoundingMode;

public class BigDecimalDemo {
    public static void main(String[] args) {
        // 展示精度問題
        System.out.println(0.1 + 0.2); // 0.30000000000000004 (精度問題)
        
        // 使用BigDecimal解決精度問題
        BigDecimal bd1 = BigDecimal.valueOf(0.1);
        BigDecimal bd2 = BigDecimal.valueOf(0.2);
        BigDecimal sum = bd1.add(bd2);
        System.out.println("BigDecimal加法: " + sum); // 0.3
        
        // 建立BigDecimal物件
        BigDecimal num1 = new BigDecimal("10.5");
        BigDecimal num2 = new BigDecimal("3.2");
        
        // 四則運算
        System.out.println("加法: " + num1.add(num2));      // 13.7
        System.out.println("減法: " + num1.subtract(num2)); // 7.3
        System.out.println("乘法: " + num1.multiply(num2)); // 33.60
        
        // 除法 - 指定精度和捨入模式
        BigDecimal result = num1.divide(num2, 2, RoundingMode.HALF_UP);
        System.out.println("除法: " + result); // 3.28 (保留2位小數，四捨五入)
        
        // 貨幣計算範例
        BigDecimal price = new BigDecimal("19.99");
        BigDecimal quantity = new BigDecimal("3");
        BigDecimal tax = new BigDecimal("0.08"); // 8%稅率
        
        BigDecimal subtotal = price.multiply(quantity);
        BigDecimal taxAmount = subtotal.multiply(tax);
        BigDecimal total = subtotal.add(taxAmount);
        
        System.out.println("小計: $" + subtotal);   // $59.97
        System.out.println("稅額: $" + taxAmount.setScale(2, RoundingMode.HALF_UP)); // $4.80
        System.out.println("總計: $" + total.setScale(2, RoundingMode.HALF_UP));     // $64.77
    }
}
```

### 27.8 未完待續...	

## 28 Lambda表達式

- Lambda表達式是JDK 8開始後的一種新語法形式
- 可以用來簡化匿名內部類別的書寫

### 28.1 函數式程式設計

- 函數式程式設計 (Functional Programming) 是一種思想特點
- 函數式程式設計思想，忽略物件導向的複雜語法，強調**做什麼，而不是誰去做**
- 學習Lambda表達式就是函數式思想的體現

**傳統寫法與Lambda寫法比較：**

```java
import java.util.Arrays;
import java.util.Comparator;

public class LambdaCompare {
    public static void main(String[] args) {
        Integer[] arr = {3, 5, 7, 2, 8, 1, 9, 4, 6};
        
        // 傳統匿名內部類別寫法
        Arrays.sort(arr, new Comparator<Integer>() {
            @Override
            public int compare(Integer o1, Integer o2) {
                return o1 - o2; // 升序排列
            }
        });
        System.out.println("傳統寫法結果: " + Arrays.toString(arr));
        
        // Lambda表達式寫法
        Integer[] arr2 = {3, 5, 7, 2, 8, 1, 9, 4, 6};
        Arrays.sort(arr2, (Integer o1, Integer o2) -> {
            return o1 - o2;
        });
        System.out.println("Lambda寫法結果: " + Arrays.toString(arr2));
    }
}
```

### 28.2 Lambda表達式的標準格式

**格式：**
```java
(參數列表) -> {
    方法體
}
```

**說明：**
- **()：** 裡面是方法的參數
- **->：** 固定格式，讀作"指向"
- **{}：** 裡面是方法體

**注意：**

- Lambda表達式可以用來簡化匿名內部類別的書寫
- Lambda表達式只能簡化函數式介面的匿名內部類別的寫法
- 函數式介面：有且僅有一個抽象方法的介面叫做函數式介面，介面上方可以加`@FunctionalInterface`註解

```java
@FunctionalInterface
interface Calculator {
    int calculate(int a, int b);
}

public class LambdaStandardDemo {
    public static void main(String[] args) {
        // 標準Lambda表達式
        Calculator add = (int a, int b) -> {
            return a + b;
        };
        
        Calculator multiply = (int x, int y) -> {
            return x * y;
        };
        
        // 使用Lambda表達式
        System.out.println("5 + 3 = " + add.calculate(5, 3));      // 8
        System.out.println("5 * 3 = " + multiply.calculate(5, 3)); // 15
        
        // 在方法中使用
        useCalculator((a, b) -> a - b, 10, 4);     // 10 - 4 = 6
        useCalculator((a, b) -> a / b, 20, 5);     // 20 / 5 = 4
    }
    
    public static void useCalculator(Calculator calc, int x, int y) {
        int result = calc.calculate(x, y);
        System.out.println(x + " 運算 " + y + " = " + result);
    }
}
```

### 28.3 Lambda表達式的省略寫法

**省略規則：**
1. 參數型別可以省略不寫
2. 如果只有一個參數，參數型別可省略，同時()也可以省略
3. 如果Lambda表達式的方法體只有一行，大括號、分號、return可以省略不寫，需要同時省略

```java
import java.util.Arrays;
import java.util.function.Consumer;
import java.util.function.Predicate;

public class LambdaSimplified {
    public static void main(String[] args) {
        Integer[] arr = {3, 5, 7, 2, 8, 1, 9, 4, 6};
        
        // 1. 完整寫法
        Arrays.sort(arr, (Integer o1, Integer o2) -> {
            return o1 - o2;
        });
        
        // 2. 省略參數型別
        Arrays.sort(arr, (o1, o2) -> {
            return o1 - o2;
        });
        
        // 3. 省略大括號、return、分號 (因為只有一行)
        Arrays.sort(arr, (o1, o2) -> o1 - o2);
        
        // 4. 更簡潔的寫法 - 使用方法參考
        Arrays.sort(arr, Integer::compareTo);
        
        System.out.println("排序結果: " + Arrays.toString(arr));
        
        // 單參數的Lambda - 可以省略括號
        String[] names = {"Alice", "Bob", "Charlie", "David"};
        
        // 傳統寫法
        Arrays.stream(names).forEach(new Consumer<String>() {
            @Override
            public void accept(String s) {
                System.out.println("Hello, " + s);
            }
        });
        
        // Lambda完整寫法
        Arrays.stream(names).forEach((String name) -> {
            System.out.println("Hi, " + name);
        });
        
        // Lambda省略寫法
        Arrays.stream(names).forEach(name -> System.out.println("Hey, " + name));
        
        // 過濾範例
        Arrays.stream(names)
              .filter(name -> name.length() > 3)  // 過濾長度大於3的名字
              .forEach(name -> System.out.println("長名字: " + name));
    }
}
```

