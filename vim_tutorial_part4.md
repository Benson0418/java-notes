# Vim基礎教學講義 第四部分：暫存器與巨集

## 20 暫存器

### 20.1 暫存器概念

- Vim提供了許多暫存器用於存放內容，可以理解為剪貼簿
- 一個字元對應一個暫存器（如 `a-z`、`0-9`）

### 20.2 特殊暫存器

```
"           預設暫存器，平時複製、刪除的內容都放在裡面
%           目前檔案名
.           上一次插入的內容
:           上一次執行的指令
```

**檢視暫存器內容：**

```
:reg        檢視所有暫存器內容
:reg a      檢視a暫存器內容
```

### 20.3 指定暫存器操作

在複製/刪除操作前加上 `"{暫存器}` 就可以指定本次操作所用的暫存器

只要涉及暫存器操作的都可以這樣指定

#### 20.3.1 指定暫存器範例

```
"ayy        將這一行複製到a暫存器中
"bdiw       將單字刪除，儲存到b暫存器中
"cp         將c暫存器中的內容貼上出來
```

**常見用途：**將想要持久儲存的文字放到特定暫存器裡，隨時進行貼上，避免被覆蓋

#### 20.3.2 暫存器附加操作

**暫存器字元大寫：**附加（append）而非覆蓋

```
"Ayy        將這一行附加到A暫存器中（不覆蓋原內容）
```

## 21 巨集

### 21.1 巨集概念

**巨集（Macro）：**錄製一系列鍵盤操作，並允許我們重播這些操作

- 操作序列儲存在指定的暫存器中

### 21.2 巨集操作指令

```
q{暫存器}   開始錄製巨集，存在暫存器中
q           錄製過程中按q退出錄製
@{暫存器}   重播暫存器中的操作
@@          重播上一次巨集操作
```

### 21.3 巨集使用流程

**常見用法：**
1. `q{暫存器}` 錄製一段操作
2. `@{暫存器}` 重播
3. 然後一直 `@@` 重播

**注意：**`.` 指令對巨集不生效，`.` 指令只記錄上一次修改，而巨集可能包含多次修改

### 21.4 巨集最佳實務

#### 21.4.1 讓你的巨集對連續重播友好

**建議步驟：**

1. **讓你的游標移動更加通用**
2. **假設你要在多個特定的位置進行特定的操作，一個好的習慣是在巨集錄製的最後，跳轉到下一個需要編輯的位置**

即，巨集包括：**【編輯動作】** + **【跳轉到下一個需要編輯的位置】**

這樣一來，連續重播就可以實現對所有需要編輯的位置進行編輯操作

#### 21.4.2 巨集的擴充

**透過大寫的暫存器，在巨集的後面新增指令**

如果巨集是重播友好的，允許我們使用 `[次數]@[暫存器]` 直接重播指定次數

**範例：**
```
5@a         重播a暫存器中的巨集5次
```

## 小結

- 了解暫存器的概念
- 了解常用的內建暫存器
- **（重要）**掌握使用巨集進行批次操作
- 掌握 `(操作符)(文字物件)` 的操作哲學